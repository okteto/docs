---
title: AWS
description: Configure AWS credentials
sidebar_label: aws
id: aws-cloud-credentials
---
import Image from "@theme/Image";


This tutorial will guide you on how to configure AWS credentials for your Okteto instance. Configuring AWS credentials enables the deploy, test, and destroy commands in your Okteto Manifest to access your AWS account.

In this specific guide we'll request access to an s3 resource but you can provide access to any other AWS resource by using a role with more/different permissions.

It's recommended that you have the [AWS CLI installed](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html#getting-started-install-instructions) to follow this tutorial.

AWS credentials are configured using [OIDC federation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_oidc.html) to [assume an IAM Role via Web Identity](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_manage-assume.html).

## Step 1: Create the Identity Provider

As a first step let's register the Kubernetes cluster as an OIDC identity provider in AWS.

```bash
OIDC_ENDPOINT=https://container.googleapis.com/v1/projects/my-project-12345/locations/us-central1/clusters/development
AUDIENCE=registry.okteto.dev
aws iam create-open-id-connect-provider --url "${OIDC_ENDPOINT}" --client-id-list "${AUDIENCE}"
{
    "OpenIDConnectProviderArn": "arn:aws:iam::112233445566:oidc-provider/container.googleapis.com/v1/projects/my-project-12345/locations/us-central1/clusters/development"
}
```

Okteto displays the OIDC endpoint of your cluster in the Admin -> General view of the Dashboard:

   <p align="center">
     <Image
       src={require("@site/static/img/amazon-ecr-oidc-config.png").default}
       alt="OIDC configuration in admin general view"
     />
   </p>

Traditionally, `AUDIENCE` is the client id of the requester. You'll only exchange token for these audiences. It is the `aud` field of the JWT payload.

We recommend creating a different/dedicated audience for each Okteto instance and region used, even if you use the same identity provider:

```
your-okteto-instance.com/112233445566.your-region.amazonaws.com
```

or the more compact format:

```
your-okteto-instance.com/your-region
```

## Step 2: Create the Role


First create the role and allow it to access s3:

```bash
# ROLE_ARN is the OpenIDConnectProviderArn role name created in step 1
ROLE_ARN=arn:aws:iam::112233445566:oidc-provider/container.googleapis.com/v1/projects/my-project-12345/locations/us-central1/clusters/development
AUDIENCE=deploy.okteto.dev
OKTETO_SERVICE_ACCOUNT=system:serviceaccount:okteto:okteto
cat <<EOT > trust-policy.json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Federated": "${ROLE_ARN}"
      },
      "Action": "sts:AssumeRoleWithWebIdentity",
      "Condition": {
        "StringEquals": {
          "container.googleapis.com/v1/projects/my-project-12345/locations/us-central1/clusters/development:aud": "${AUDIENCE}",
          "container.googleapis.com/v1/projects/my-project-12345/locations/us-central1/clusters/development:sub": "${OKTETO_SERVICE_ACCOUNT}"
        }
      }
    }
  ]
}
EOT


aws iam create-role --role-name okteto-credentials --assume-role-policy-document file://trust-policy.json
{
    "Role": {
        "Path": "/",
        "RoleName": "okteto-credentials",
        "RoleId": "AR...",
        "Arn": "arn:aws:iam::112233445566:role/okteto-credentials",
        "CreateDate": "2024-06-10T15:04:05+00:00",
        "AssumeRolePolicyDocument": {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Effect": "Allow",
                    "Principal": {
                        "Service": "s3.amazonaws.com"
                    },
                    "Action": "sts:AssumeRole"
                }
            ]
        }
    }
}
```

Attach an s3 policy to read and write s3 buckets:


```bash
aws iam attach-role-policy --role-name my-private-registry --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess
```


## Step 3: Configure the credentials in Okteto

Enable AWS in the [Cloud Credentials view](index.mdx) with the following configuration:

- **Role ARN**: The Role ARN from the previous step
- **Region**: The AWS Region
- **Audience**: The Audience used for the Identity Provider


This will allow Okteto to access the desired AWS resources in okteto deploy, test, and destroy commands.

With the above configuration the following Okteto Manifest will be able to access the s3 bucket out of the box for all three commands:

```yaml
deploy:
  image: amazon/aws-cli
  commands:
    - aws s3api create-bucket --bucket test-bucket
destroy:
  image: amazon/aws-cli
  commands:
    - aws s3api delete-bucket --bucket test-bucket
test:
  aws:
    image: amazon/aws-cli
    commands:
      - aws s3 ls | grep test-bucket
```
