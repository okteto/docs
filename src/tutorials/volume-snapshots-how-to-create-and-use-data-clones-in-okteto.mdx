---
title: Volume Snapshots: How to Create a Development Environment with Realistic Data in Okteto
description: Learn how to create a data clone of an applicationâ€™s database, and how to use it when creating a new Development Environment.
---

import Image from '@theme/Image';

Data cloning allows you to create an independent, identical copy of an applicationâ€™s database, making it easy to test with realistic data.
Using Okteto Volume Snapshots, you can quickly create development environments that include production or staging dataâ€”without manually copying databases or waiting for CI/CD pipelines.

:::tip
Volume Snapshots are also useful for loading test data when running tests in Okteto Test. If your tests require a database with preloaded data, you can configure your test environment to restore from a snapshot instead of initializing an empty database. This ensures consistency across test runs and reduces setup time.
:::

In this tutorial, you'll:
âœ… deploy an application to Okteto
âœ… learn how to create a data clone of the application's database
âœ… and then learn how to use it when creating a new Development Environment

## Prerequisites

In order to follow this tutorial, you should have:

-   A **Kubernetes cluster with Okteto** installed
-   Familiarity with **Kubernetes manifests**
-   [kubectl](https://kubernetes.io/docs/tasks/tools/) installed on your machine

## Step 1: Deploy the Sample Application

For this tutorial, weâ€™ll deploy a CRUD recipe application that stores data in MongoDB.

Clone the repository:
```console
$ git clone https://github.com/okteto/fastapi-snapshot-app
$ cd fastapi-snapshot-app
```

In the `manifests` folder, the `k8s.yml` manifest file is responsible for the deployment of the application's service, and the `mongo.yml` manifest file is responsible for deploying the database service. The database service in this case is a MongoDB service.

Apply the manifests to deploy the application:

```console
okteto kubeconfig
kubectl apply -f manifests/
```

Expected output:
```console
deployment.apps/fastapi-snapshot-demo created
service/fastapi-snapshot-demo created
persistentvolumeclaim/data created
service/mongodb created
statefulset.apps/mongodb created
```

<Image
  src={require("@site/static/img/tutorials/volume-snapshots/deployed.png").default}
  alt="Deployed Application"
  width="1000"
/>

âœ… Your application is now running in Okteto. Take note of the **endpoint URL** under **Endpoints** in the Okteto Dashboard.


## Step 2: Populate the Application Database

Before taking a snapshot, add sample data. This is the data that we'll be including in the Development Environments that we'll create in the next steps.

```console
curl -X 'POST' \
  'https://fastapi-snapshot-demo-yournamespace.YOURSUBDOMAIN/recipe' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "name": "Donuts",
  "ingredients": ["Flour", "Milk", "Sugar", "Vegetable Oil"]
}'
```

```console
curl -X 'POST' \
  'https://fastapi-snapshot-demo-yournamespace.YOURSUBDOMAIN/recipe' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "name": "Pancake",
  "ingredients": ["Flour", "Milk", "Sugar", "Baking Powder", "Vegetable Oil"]
}'
```

Verify that the database has been populated by retrieving the list of recipes present:

```console
 curl -X 'GET' \
  'https://fastapi-snapshot-demo-yournamespace.YOURSUBDOMAIN/recipe' \
  -H 'accept: application/json'
```

Expected response:

```json
{
  "data": [
    {
      "id": "60ce68651eeddf1c5ab796d1",
      "name": "Donuts",
      "ingredients": [
        "Flour",
        "Milk",
        "Sugar",
        "Vegetable Oil"
      ]
    },
    {
      "id": "60ce689c1eeddf1c5ab796d2",
      "name": "Pancake",
      "ingredients": [
        "Flour",
        "Milk",
        "Sugar",
        "Baking Powder",
        "Vegetable Oil"
      ]
    }
  ]
}
```

## Step 3: Create a Database Snapshot

A Volume Snapshot will capture the database state at this moment.

Create a new manifest file `snapshot.yml` in the `manifests` folder and add the following to it:

```yaml
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshot
metadata:
  name: mongo-snapshot
spec:
  volumeSnapshotClassName: okteto-snapshot-class
  source:
    persistentVolumeClaimName: data-mongodb-0
```

In the Volume Snapshot Manifest above, you are creating a Volume Snapshot named `mongo-snapshot`, the snapshot will be created from the persistent volume `data-mongodb-0` which was created by the MongoDB manifest.


Next, apply the Volume Snapshot from your terminal:

```console
kubectl apply -f manifests/snapshot.yml
```

Finally, verify that the volume snapshot has been created successfully.

```console
kubectl get volumesnapshot
```

âœ… Now we have a snapshot that can be used for new development environments!


## Step 4: Deploy a Development Environment Using the Snapshot

### 1. Create a New Namespace for Development

```console
okteto namespace create data-clone-$YOUR_OKTETO_USERNAME
```

### 2. Modify the Application Manifest to Use the Snapshot

Create a new folder in the parent directory and copy `k8s.yml` and `mongo.yml` into it:

```console
mkdir data-clone-manifest
cp manifests/{k8s.yml,mongo.yml} data-clone-manifest
```

Update `mongo.yml` to reference the snapshot:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: mongodb
spec:
  ports:
    - port: 27017
      targetPort: 27017
  clusterIP: None
  selector:
    app: mongo
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mongodb
spec:
  serviceName: mongodb
  replicas: 1
  selector:
    matchLabels:
      app: mongo
  template:
    metadata:
      labels:
        app: mongo
    spec:
      containers:
        - name: mongodb
          image: bitnami/mongodb:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 27017
              protocol: TCP
          resources: { }
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /bitnami/mongodb
              name: data
              subPath: data
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: data
            annotations:
              dev.okteto.com/from-snapshot-name: mongo-snapshot
              dev.okteto.com/from-snapshot-namespace: YOUR_DATA_SOURCE_NAMESPACE
            spec:
              accessModes:
                - ReadWriteOnce
              resources:
                requests:
                  storage: 1Gi
---
```

Replace `$YOUR_DATA_NAMESPACE` with the name of the namespace you created the volume snapshot in.

In the updated manifest above, you have removed the section that creates a persistent volume for the MongoDB service and added a subsection under the Statefulset's spec.

In the `volumeClaimTemplates` subsection, `annotations` have been added to instruct Okteto to create the data source for the stateful set from the snapshot created earlier `mongo-snapshot` in the `namespace`.

### 3. Deploy the New Development Environment Using the Newly Created Manifest

```console
kubectl apply -f data-clone-manifest
```

Expected output:
```console
deployment.apps/fastapi-snapshot-demo created
service/fastapi-snapshot-demo created
service/mongodb created
statefulset.apps/mongodb created
```

âœ… Your new development environment is now running with real data! It can be accessed from the UI


## Step 5: Verify the Data Clone

The final step is to retrieve the list of recipes from the newly deployed application. This is to verify that the development environment was created with the expected data.

Run the following command to check if the development database contains the same data as the original:

```console
curl -X 'GET' \
  'https://fastapi-snapshot-demo-data-clone-yournamespace.YOURSUBDOMAIN/recipe' \
  -H 'accept: application/json'
```

Expected response:

```json
{
  "data": [
    {
      "id": "60ce68651eeddf1c5ab796d1",
      "name": "Donuts",
      "ingredients": ["Flour", "Milk", "Sugar", "Vegetable Oil"]
    },
    {
      "id": "60ce689c1eeddf1c5ab796d2",
      "name": "Pancake",
      "ingredients": ["Flour", "Milk", "Sugar", "Baking Powder", "Vegetable Oil"]
    }
  ]
}
```

âœ… Success! The new environment has been created with a cloned database.

## Conclusion

In this tutorial, you learned how to:
âœ” Deploy an application with a database in Okteto
âœ” Create a Volume Snapshot to capture its state
âœ” Use the snapshot to spin up a new development environment with real data

By using Okteto Volume Snapshots, you can:
- Quickly replicate staging or production data for testing
- Eliminate the need for manual database migrations
- Speed up the development and debugging process

ðŸ“– Next Steps: [Explore more on Okteto Volume Snapshots](https://www.okteto.com/docs/core/use-volume-snapshots/)

The code used for this article can be found on [GitHub](https://github.com/okteto/fastapi-snapshot-app/tree/data-clone-manifest/).
